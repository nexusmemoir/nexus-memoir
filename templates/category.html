<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ category.name }} - AkademikSoru</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-icon">üî¨</span>
                <span>AkademikSoru</span>
            </a>
            <nav class="nav">
                <a href="/">Ana Sayfa</a>
                {% if user %}
                <div class="user-menu">
                    <a href="/profile" class="user-name">üë§ {{ user.display_name }}</a>
                    <a href="/logout" class="btn-logout">√áƒ±kƒ±≈ü</a>
                </div>
                {% else %}
                <a href="/login" class="btn-login">Giri≈ü Yap</a>
                <a href="/register" class="btn-register">Kayƒ±t Ol</a>
                {% endif %}
            </nav>
        </div>
    </header>

    <main class="result-page">
        <div class="container">
            <div class="claim-box">
                <div class="claim-label">Kategori</div>
                <h1 class="claim-text">
                    <span style="font-size: 1.2em; margin-right: 12px;">{{ category.icon }}</span>
                    {{ category.name }}
                </h1>
            </div>

            {% if user %}
            <div class="action-bar">
                <button class="save-btn {% if is_following %}saved{% endif %}" id="followBtn" onclick="toggleFollow()">
                    <span>{{ '‚ù§Ô∏è' if is_following else 'ü§ç' }}</span>
                    <span id="followText">{{ 'Takip Ediliyor' if is_following else 'Takip Et' }}</span>
                </button>
            </div>
            {% endif %}

            <div class="popular-questions-section" style="padding-top: 20px;">
                <h2 class="section-title">Bu Kategorideki Sorular</h2>
                {% if questions %}
                <div class="questions-grid">
                    {% for q in questions %}
                    <div class="question-card" onclick="searchQuestion('{{ q.question }}')">
                        <div class="question-header">
                            <span class="question-icon">{{ q.icon }}</span>
                            <span class="question-category">{{ q.category }}</span>
                        </div>
                        <h3 class="question-title">{{ q.question }}</h3>
                        <p class="question-preview">{{ q.preview }}</p>
                        <div class="question-footer">
                            <span class="evidence-badge evidence-{{ q.evidence_level }}">
                                {% if q.evidence_level == 'strong' %}‚úì G√º√ßl√º Kanƒ±t
                                {% elif q.evidence_level == 'moderate' %}‚óê Orta Kanƒ±t
                                {% else %}‚óã Sƒ±nƒ±rlƒ± Kanƒ±t{% endif %}
                            </span>
                            <span class="question-action">Ara≈ütƒ±r ‚Üí</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Bu kategoride hen√ºz pop√ºler soru bulunmuyor.</p>
                    <a href="/" class="btn-primary">Soru Sor</a>
                </div>
                {% endif %}
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>¬© 2025 AkademikSoru - Bilimsel Ara≈ütƒ±rma Platformu</p>
        </div>
    </footer>

    <script>
        let isFollowing = {{ 'true' if is_following else 'false' }};

        function searchQuestion(q) {
            const params = new URLSearchParams({ q: q, level: 'medium' });
            window.location.href = '/result?' + params.toString();
        }

        async function toggleFollow() {
            const endpoint = isFollowing ? '/api/topics/unfollow' : '/api/topics/follow';
            const formData = new FormData();
            formData.append('category', '{{ category.name }}');

            try {
                const response = await fetch(endpoint, { method: 'POST', body: formData });
                if (response.ok) {
                    isFollowing = !isFollowing;
                    const btn = document.getElementById('followBtn');
                    const text = document.getElementById('followText');
                    btn.classList.toggle('saved');
                    btn.querySelector('span:first-child').textContent = isFollowing ? '‚ù§Ô∏è' : 'ü§ç';
                    text.textContent = isFollowing ? 'Takip Ediliyor' : 'Takip Et';
                } else if (response.status === 401) {
                    window.location.href = '/login';
                }
            } catch (e) {
                console.error(e);
            }
        }
    </script>
</body>
</html>
