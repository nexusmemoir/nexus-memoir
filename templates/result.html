<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonuÃ§lar - ClaimCheck</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-icon">ğŸ”</span>
                <span class="logo-text">ClaimCheck</span>
            </a>
            <nav class="nav">
                <a href="/" class="btn-new-search">+ Yeni Arama</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="result-page">
        <div class="container">
            
            <!-- Claim Display -->
            <div class="claim-box">
                <div class="claim-label">Aranan Ä°ddia</div>
                <h1 id="normalizedClaim" class="claim-text">YÃ¼kleniyor...</h1>
            </div>

            <!-- Summary -->
            <section class="summary-section">
                <h2>ğŸ“‹ Ã–zet</h2>
                <div id="summaryText" class="summary-content">
                    YÃ¼kleniyor...
                </div>
                <div id="notesSection" class="notes-box" style="display: none;">
                    <strong>ğŸ“ Notlar:</strong>
                    <ul id="notesList"></ul>
                </div>
            </section>

            <!-- Timeline -->
            <section class="timeline-section">
                <h2>ğŸ“… Zaman Ã‡izelgesi</h2>
                <div id="timelineContainer" class="timeline">
                    <p class="empty-state">Zaman Ã§izelgesi oluÅŸturulamadÄ±.</p>
                </div>
            </section>

            <!-- Ad Space -->
            <div class="ad-placeholder ad-inline">
                <span>Reklam AlanÄ±</span>
            </div>

            <!-- Sources Tabs -->
            <section class="sources-section">
                <div class="tabs">
                    <button class="tab active" data-tab="news">
                        ğŸ“° Haberler <span id="newsCount" class="count">0</span>
                    </button>
                    <button class="tab" data-tab="scholar">
                        ğŸ“š Akademik <span id="scholarCount" class="count">0</span>
                    </button>
                </div>

                <!-- News Results -->
                <div id="newsTab" class="tab-content active">
                    <div id="newsResults" class="sources-grid">
                        <p class="empty-state">Haber bulunamadÄ±.</p>
                    </div>
                </div>

                <!-- Scholar Results -->
                <div id="scholarTab" class="tab-content">
                    <div id="scholarResults" class="sources-grid">
                        <p class="empty-state">Akademik kaynak bulunamadÄ±.</p>
                    </div>
                </div>
            </section>

            <!-- Keywords -->
            <section class="keywords-section">
                <h3>ğŸ·ï¸ Anahtar Kelimeler</h3>
                <div id="keywordsList" class="keywords-list">
                    <!-- Keywords will be inserted here -->
                </div>
            </section>

            <!-- Stats (Debug) -->
            <section class="stats-section" id="statsSection" style="display: none;">
                <h3>ğŸ“Š Arama Ä°statistikleri</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="statQueries">0</span>
                        <span class="stat-label">Sorgu Ãœretildi</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statRawNews">0</span>
                        <span class="stat-label">Ham Haber Bulundu</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statFiltered">0</span>
                        <span class="stat-label">AlakalÄ± Haber</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statAcademic">0</span>
                        <span class="stat-label">Akademik Kaynak</span>
                    </div>
                </div>
            </section>

            <!-- Queries Used (Collapsible) -->
            <details class="queries-section">
                <summary>ğŸ” KullanÄ±lan Arama SorgularÄ±</summary>
                <div id="queriesList" class="queries-list">
                    <!-- Queries will be inserted here -->
                </div>
            </details>

            <!-- Disclaimer -->
            <div class="disclaimer result-disclaimer">
                <p>
                    <strong>âš ï¸ Ã–nemli:</strong> Bu araÃ§ doÄŸruluk hÃ¼kmÃ¼ vermez. 
                    YalnÄ±zca Ã§evrimiÃ§i kaynaklarda iz sÃ¼rer. 
                    Kaynaklar Ã¼Ã§Ã¼ncÃ¼ taraf sitelerdir.
                </p>
            </div>

            <!-- New Search -->
            <div class="new-search-box">
                <a href="/" class="btn-search">ğŸ” Yeni Arama Yap</a>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>Â© 2026 ClaimCheck - Kaynak Sorgulama AracÄ±</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultData = sessionStorage.getItem('claimResult');
            
            if (!resultData) {
                window.location.href = '/';
                return;
            }

            const data = JSON.parse(resultData);
            renderResults(data);
        });

        function renderResults(data) {
            // Normalized Claim
            document.getElementById('normalizedClaim').textContent = 
                data.normalized_claim || sessionStorage.getItem('originalClaim') || 'Ä°ddia';

            // Summary
            document.getElementById('summaryText').textContent = 
                data.summary || 'Ã–zet oluÅŸturulamadÄ±.';

            // Notes
            if (data.notes && data.notes.length > 0) {
                const notesSection = document.getElementById('notesSection');
                const notesList = document.getElementById('notesList');
                notesSection.style.display = 'block';
                data.notes.forEach(note => {
                    const li = document.createElement('li');
                    li.textContent = note;
                    notesList.appendChild(li);
                });
            }

            // Timeline
            renderTimeline(data.timeline || [], data.news_results || []);

            // News Results
            const newsResults = data.news_results || [];
            document.getElementById('newsCount').textContent = newsResults.length;
            renderNews(newsResults);

            // Scholar Results
            const scholarResults = data.scholar_results || [];
            document.getElementById('scholarCount').textContent = scholarResults.length;
            renderScholar(scholarResults);

            // Keywords
            renderKeywords(data.keywords || []);

            // Stats
            if (data.stats) {
                document.getElementById('statsSection').style.display = 'block';
                document.getElementById('statQueries').textContent = data.stats.total_queries || 0;
                document.getElementById('statRawNews').textContent = data.stats.raw_news_found || 0;
                document.getElementById('statFiltered').textContent = data.stats.filtered_news || 0;
                document.getElementById('statAcademic').textContent = data.stats.academic_found || 0;
            }

            // Queries Used
            if (data.queries_used && data.queries_used.length > 0) {
                const queriesList = document.getElementById('queriesList');
                let html = '';
                data.queries_used.forEach(q => {
                    html += `<span class="query-tag">${escapeHtml(q)}</span>`;
                });
                queriesList.innerHTML = html;
            }

            // Setup tabs
            setupTabs();
        }

        function renderTimeline(timeline, sources) {
            const container = document.getElementById('timelineContainer');
            
            if (!timeline || timeline.length === 0) {
                container.innerHTML = '<p class="empty-state">Zaman Ã§izelgesi oluÅŸturulamadÄ±.</p>';
                return;
            }

            let html = '';
            timeline.forEach((item, index) => {
                const refs = item.refs || [];
                const refLinks = refs.map(refIdx => {
                    const source = sources[refIdx];
                    if (source) {
                        return `<a href="${source.url}" target="_blank" rel="noopener" class="ref-link">[${refIdx + 1}]</a>`;
                    }
                    return '';
                }).join(' ');

                html += `
                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">${item.date || 'Tarih belirsiz'}</div>
                            <div class="timeline-event">${item.event || ''}</div>
                            <div class="timeline-refs">${refLinks}</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderNews(results) {
            const container = document.getElementById('newsResults');
            
            if (!results || results.length === 0) {
                container.innerHTML = '<p class="empty-state">Haber bulunamadÄ±.</p>';
                return;
            }

            let html = '';
            results.forEach((item, index) => {
                const date = item.date ? formatDate(item.date) : 'Tarih yok';
                html += `
                    <a href="${item.url}" target="_blank" rel="noopener" class="source-card">
                        <div class="source-index">${index + 1}</div>
                        <div class="source-content">
                            <h4 class="source-title">${escapeHtml(item.title || 'BaÅŸlÄ±ksÄ±z')}</h4>
                            <div class="source-meta">
                                <span class="source-publisher">${escapeHtml(item.source || 'Bilinmeyen')}</span>
                                <span class="source-date">${date}</span>
                            </div>
                        </div>
                        <div class="source-arrow">â†’</div>
                    </a>
                `;
            });

            container.innerHTML = html;
        }

        function renderScholar(results) {
            const container = document.getElementById('scholarResults');
            
            if (!results || results.length === 0) {
                container.innerHTML = '<p class="empty-state">Akademik kaynak bulunamadÄ±.</p>';
                return;
            }

            let html = '';
            results.forEach((item, index) => {
                html += `
                    <a href="${item.url}" target="_blank" rel="noopener" class="source-card scholar">
                        <div class="source-index">${index + 1}</div>
                        <div class="source-content">
                            <h4 class="source-title">${escapeHtml(item.title || 'BaÅŸlÄ±ksÄ±z')}</h4>
                            <div class="source-meta">
                                <span class="source-authors">${escapeHtml(item.authors || '')}</span>
                                <span class="source-year">${item.year || ''}</span>
                            </div>
                            ${item.venue ? `<div class="source-venue">${escapeHtml(item.venue)}</div>` : ''}
                            ${item.citations ? `<div class="source-citations">ğŸ“Š ${item.citations} alÄ±ntÄ±</div>` : ''}
                        </div>
                        <div class="source-arrow">â†’</div>
                    </a>
                `;
            });

            container.innerHTML = html;
        }

        function renderKeywords(keywords) {
            const container = document.getElementById('keywordsList');
            
            if (!keywords || keywords.length === 0) {
                container.innerHTML = '<span class="empty-state">-</span>';
                return;
            }

            let html = '';
            keywords.forEach(kw => {
                html += `<span class="keyword-tag">${escapeHtml(kw)}</span>`;
            });

            container.innerHTML = html;
        }

        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active from all
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active to clicked
                    tab.classList.add('active');
                    const tabName = tab.dataset.tab;
                    document.getElementById(tabName + 'Tab').classList.add('active');
                });
            });
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('tr-TR', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            } catch {
                return dateStr;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
