<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaps√ºl Dashboard - NexusMemoir</title>
    <link rel="icon" type="image/png" href="/static/images/nexusmemoir-logo.png">
    <link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
    <canvas id="neuralBg"></canvas>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="/static/images/nexusmemoir-logo.png" alt="NexusMemoir" class="logo-icon" style="width: 32px; height: 32px; object-fit: contain;">
                <span class="logo-text">NexusMemoir</span>
            </div>
            <div class="nav-actions">
                <span class="capsule-id">Kaps√ºl #{{ capsule.id }}</span>
                <a href="/logout" class="btn-logout">√áƒ±kƒ±≈ü</a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <!-- Capsule Status Card -->
        <div class="status-card">
            <div class="status-header">
                {% if open %}
                <div class="status-badge status-open">
                    <span class="status-icon">üîì</span>
                    <span>A√áIK</span>
                </div>
                {% elif capsule.unlock_at %}
                <div class="status-badge status-locked">
                    <span class="status-icon">üîí</span>
                    <span>Kƒ∞Lƒ∞TLƒ∞</span>
                </div>
                {% else %}
                <div class="status-badge status-pending">
                    <span class="status-icon">‚è±Ô∏è</span>
                    <span>ZAMAN BELƒ∞RLENMEDƒ∞</span>
                </div>
                {% endif %}
            </div>

            {% if capsule.unlock_at and not open %}
            <!-- Countdown Timer -->
            <div class="countdown-section">
                <h2 class="countdown-title">Kaps√ºl A√ßƒ±lana Kadar</h2>
                <div class="countdown-timer" data-unlock="{{ capsule.unlock_at }}">
                    <div class="time-unit">
                        <div class="time-value" id="days">--</div>
                        <div class="time-label">G√ºn</div>
                    </div>
                    <div class="time-separator">:</div>
                    <div class="time-unit">
                        <div class="time-value" id="hours">--</div>
                        <div class="time-label">Saat</div>
                    </div>
                    <div class="time-separator">:</div>
                    <div class="time-unit">
                        <div class="time-value" id="minutes">--</div>
                        <div class="time-label">Dakika</div>
                    </div>
                    <div class="time-separator">:</div>
                    <div class="time-unit">
                        <div class="time-value" id="seconds">--</div>
                        <div class="time-label">Saniye</div>
                    </div>
                </div>
                <p class="unlock-date">
                    A√ßƒ±lƒ±≈ü: <strong id="unlock-local">{{ capsule.unlock_at }}</strong>
                </p>
            </div>
            {% elif open %}
            <div class="unlocked-section">
                <div class="unlocked-icon">üéâ</div>
                <h2>Kaps√ºl√ºn A√ßƒ±ldƒ±!</h2>
                <p>T√ºm i√ßeriklerine eri≈üebilirsin</p>
            </div>
            {% endif %}

            <!-- Capacity Stats -->
            <div class="capacity-stats">
                <div class="stat-item">
                    <div class="stat-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ (notes_c / MAX_NOTES * 100) }}%"></div>
                        </div>
                        <span class="stat-label">üìù Metin</span>
                        <span class="stat-count">{{ notes_c }}/{{ MAX_NOTES }}</span>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ (photos_c / MAX_PHOTOS * 100) }}%"></div>
                        </div>
                        <span class="stat-label">üì∏ Foto</span>
                        <span class="stat-count">{{ photos_c }}/{{ MAX_PHOTOS }}</span>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ (videos_c / MAX_VIDEOS * 100) }}%"></div>
                        </div>
                        <span class="stat-label">üé• Video</span>
                        <span class="stat-count">{{ videos_c }}/{{ MAX_VIDEOS }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">
            <!-- Set Unlock Time (if not set) -->
            {% if not capsule.unlock_at %}
            <div class="content-card">
                <div class="card-header">
                    <h3>‚è∞ Kilit Zamanƒ±</h3>
                </div>
                <div class="card-body">
                    <p class="card-description">Kaps√ºl√ºn hangi tarihte a√ßƒ±lacaƒüƒ±nƒ± belirle</p>
                    <form method="POST" action="/set-unlock" class="time-form">
                        <input 
                            type="datetime-local" 
                            name="unlock_at" 
                            required
                            class="time-input"
                        >
                        <button type="submit" class="btn-primary">
                            <span>Zamanƒ± Ayarla</span>
                        </button>
                    </form>
                    <small class="form-hint">Test i√ßin 1-2 dakika sonrasƒ±na ayarlayabilirsin (TR saati kabul edilir)</small>
                </div>
            </div>
            {% endif %}

            <!-- Add Note -->
            {% if not open %}
            <div class="content-card">
                <div class="card-header">
                    <h3>üìù Anƒ± Yaz</h3>
                    <span class="card-badge">Maksimum {{ MAX_NOTES }} metin</span>
                </div>
                <div class="card-body">
                    {% if notes_c >= MAX_NOTES %}
                    <p class="limit-message">Metin limiti doldu</p>
                    {% else %}
                    <p class="card-description">Bug√ºn√ºn zihninden geleceƒüe bir not...</p>
                    <form method="POST" action="/add-note" class="note-form">
                        <textarea 
                            name="text" 
                            placeholder="Bug√ºnden geleceƒüe bir notun..."
                            required
                            rows="4"
                        ></textarea>
                        <button type="submit" class="btn-primary">
                            <span>Metni Kaydet</span>
                        </button>
                    </form>
                    <small class="form-hint">ƒ∞pucu: kƒ±sa, net, "tek okumada vururcu" notlar daha iyi.</small>
                    {% endif %}
                </div>
            </div>

            <!-- Upload Photo -->
            <div class="content-card">
                <div class="card-header">
                    <h3>üñºÔ∏è Foto Y√ºkle</h3>
                    <span class="card-badge">jpg / png / webp ‚Ä¢ max 10MB</span>
                </div>
                <div class="card-body">
                    {% if photos_c >= MAX_PHOTOS %}
                    <p class="limit-message">Foto limiti doldu</p>
                    {% else %}
                    <p class="card-description">Anƒ± fotoƒüraflarƒ±nƒ± ekle</p>
                    <form method="POST" action="/upload/photo" enctype="multipart/form-data" class="upload-form">
                        <div class="file-upload">
                            <input type="file" name="file" accept="image/jpeg,image/png,image/webp" required id="photo-input">
                            <label for="photo-input" class="file-label">
                                <span class="file-icon">üì∑</span>
                                <span class="file-text">Dosya Se√ß</span>
                            </label>
                        </div>
                        <button type="submit" class="btn-primary">
                            <span>Foto Y√ºkle</span>
                        </button>
                    </form>
                    <small class="form-hint">Maksimum {{ MAX_PHOTOS }} foto. ≈ûu an {{ photos_c }} adet.</small>
                    {% endif %}
                </div>
            </div>

            <!-- Upload Video -->
            <div class="content-card">
                <div class="card-header">
                    <h3>üé¨ Video Y√ºkle</h3>
                    <span class="card-badge">mp4 / webm / mov ‚Ä¢ max 80MB</span>
                </div>
                <div class="card-body">
                    {% if videos_c >= MAX_VIDEOS %}
                    <p class="limit-message">Video limiti doldu</p>
                    {% else %}
                    <p class="card-description">√ñzel anlarƒ±nƒ± videoya al</p>
                    <form method="POST" action="/upload/video" enctype="multipart/form-data" class="upload-form">
                        <div class="file-upload">
                            <input type="file" name="file" accept="video/mp4,video/webm,video/quicktime" required id="video-input">
                            <label for="video-input" class="file-label">
                                <span class="file-icon">üé•</span>
                                <span class="file-text">Dosya Se√ß</span>
                            </label>
                        </div>
                        <button type="submit" class="btn-primary">
                            <span>Video Y√ºkle</span>
                        </button>
                    </form>
                    <small class="form-hint">Maksimum {{ MAX_VIDEOS }} video.</small>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Saved Content (only visible when open) -->
        {% if open %}
        <div class="saved-content">
            <h2 class="section-title">üíæ Kayƒ±tlƒ± ƒ∞√ßerikler</h2>

            <!-- Notes -->
            {% if notes %}
            <div class="content-section">
                <h3 class="subsection-title">üìù Metinler ({{ notes_c }})</h3>
                <div class="notes-grid">
                    {% for note in notes %}
                    <div class="note-item">
                        <div class="note-text">{{ note.text }}</div>
                        <div class="note-date">{{ note.created_at }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Photos -->
            {% if photos %}
            <div class="content-section">
                <h3 class="subsection-title">üì∏ Fotoƒüraflar ({{ photos_c }})</h3>
                <div class="photos-grid">
                    {% for photo in photos %}
                    <a href="/m/{{ photo.id }}" target="_blank" class="photo-item">
                        <div class="photo-placeholder">
                            <span class="photo-icon">üñºÔ∏è</span>
                            <span class="photo-name">{{ photo.original_name }}</span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Video -->
            {% if video %}
            <div class="content-section">
                <h3 class="subsection-title">üé• Video</h3>
                <a href="/m/{{ video.id }}" target="_blank" class="video-item">
                    <div class="video-placeholder">
                        <span class="video-icon">‚ñ∂Ô∏è</span>
                        <span class="video-name">{{ video.original_name }}</span>
                    </div>
                </a>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <script src="/static/js/neural-bg.js"></script>
    <script src="/static/js/countdown.js"></script>
</body>
</html>
